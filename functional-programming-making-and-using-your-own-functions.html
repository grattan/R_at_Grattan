<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>13 Functional programming: making and using your own functions | Using R at Grattan Institute</title>
<meta name="author" content="Matt Cowgill, Will Mackey, and James Ha">
<meta name="description" content="Why on earth would you create your own function? It can be useful to make your own function  13.1 Set up We will use the tidyverse and purrr in this chapter. library(tidyverse) ## ── Attaching...">
<meta name="generator" content="bookdown 0.23.1 with bs4_book()">
<meta property="og:title" content="13 Functional programming: making and using your own functions | Using R at Grattan Institute">
<meta property="og:type" content="book">
<meta property="og:description" content="Why on earth would you create your own function? It can be useful to make your own function  13.1 Set up We will use the tidyverse and purrr in this chapter. library(tidyverse) ## ── Attaching...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13 Functional programming: making and using your own functions | Using R at Grattan Institute">
<meta name="twitter:description" content="Why on earth would you create your own function? It can be useful to make your own function  13.1 Set up We will use the tidyverse and purrr in this chapter. library(tidyverse) ## ── Attaching...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Roboto-0.4.0/font.css" rel="stylesheet">
<link href="libs/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Using R at Grattan Institute</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li class="book-part">Part I: Why and how we use R at Grattan</li>
<li><a class="" href="what-is-r-and-what-is-r-studio-and-why-are-we-doing-all-of-this.html"><span class="header-section-number">1</span> What is R and what is R Studio and why are we doing all of this</a></li>
<li><a class="" href="getting-started.html"><span class="header-section-number">2</span> Getting started</a></li>
<li><a class="" href="organising-projects.html"><span class="header-section-number">3</span> Organising an R project at Grattan</a></li>
<li><a class="" href="coding-style.html"><span class="header-section-number">4</span> Grattan’s coding style and the tidyverse</a></li>
<li><a class="" href="packages.html"><span class="header-section-number">5</span> Using packages</a></li>
<li><a class="" href="seeking-help.html"><span class="header-section-number">6</span> Seeking help and using other resources</a></li>
<li class="book-part">Part II: Loading and transforming data</li>
<li><a class="" href="reading-data.html"><span class="header-section-number">7</span> Reading data</a></li>
<li><a class="" href="data-types.html"><span class="header-section-number">8</span> Different data types</a></li>
<li><a class="" href="data-transformation-with-dplyr.html"><span class="header-section-number">9</span> Data transformation with dplyr</a></li>
<li class="book-part">Part III: Visualising data</li>
<li><a class="" href="data-visualisation.html"><span class="header-section-number">10</span> Data Visualisation</a></li>
<li><a class="" href="chart-cookbook.html"><span class="header-section-number">11</span> Chart cookbook</a></li>
<li><a class="" href="analysis.html"><span class="header-section-number">12</span> Analysis</a></li>
<li class="book-part">Advanced topics</li>
<li><a class="active" href="functional-programming-making-and-using-your-own-functions.html"><span class="header-section-number">13</span> Functional programming: making and using your own functions</a></li>
<li><a class="" href="version-control.html"><span class="header-section-number">14</span> Version control</a></li>
<li><a class="" href="contributing-to-this-book.html"><span class="header-section-number">15</span> Contributing to this book</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="functional-programming-making-and-using-your-own-functions" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Functional programming: making and using your own functions<a class="anchor" aria-label="anchor" href="#functional-programming-making-and-using-your-own-functions"><i class="fas fa-link"></i></a>
</h1>
<p>Why on earth would you create your own function?</p>
<p>It can be useful to make your own function</p>
<div id="set-up-2" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Set up<a class="anchor" aria-label="anchor" href="#set-up-2"><i class="fas fa-link"></i></a>
</h2>
<p>We will use the <code>tidyverse</code> and <code>purrr</code> in this chapter.</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.5     ✔ purrr   0.3.4
## ✔ tibble  3.1.3     ✔ dplyr   1.0.7
## ✔ tidyr   1.1.3     ✔ stringr 1.4.0
## ✔ readr   2.0.0     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="defining-simple-functions" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> Defining simple functions<a class="anchor" aria-label="anchor" href="#defining-simple-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Like your data, a function is an <code>object</code> that is defined.</p>
<p>Let’s say you wanted to take whatever value you had and add one to it.
We could define a function called <code>add_one</code> to do this:</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_one</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span>
<span class="op">}</span></code></pre></div>
<p>There are four elements to what we just did:</p>
<ol style="list-style-type: decimal">
<li>Created a new function using the <code>function()</code> function.</li>
<li>Defined one argument (input) to the new function: <code>x</code>
</li>
<li>Gave the function instructions to ‘take <code>x</code> and add one’: <code>x + 1</code>.</li>
<li>Assigned this function to the object <code>add_one</code>.</li>
</ol>
<p>Now that you’ve done all that, you can call the function like you would any other:</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_one</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_one</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_one</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 101</code></pre>
<p>You can define functions can take more than one argument:</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_together_plus_one</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fl">1</span>
<span class="op">}</span>

<span class="fu">add_together_plus_one</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>As the above takes three arguments, and there are no defaults provided,
we’ll get an error if we fotget one:</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_together_plus_one</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in add_together_plus_one(1, 2): argument "z" is missing, with no default</code></pre>
<p>So you can also provide <em>default</em> values to your function when you define it:</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_power</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">x</span><span class="op">^</span><span class="va">n</span> 
<span class="op">}</span></code></pre></div>
<p>If you don’t provide a value for <code>n</code> when you call the <code>make_power</code> function,
it will default to <code>2</code>:</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_power</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<p>And you can override that by providing your own value:</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_power</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 10000</code></pre>
<p>We can also assign the result of this function (<code>10000</code> above) to
an object of its own:</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_power_number</span> <span class="op">&lt;-</span> <span class="fu">make_power</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>For this reason, and a few others described in a <a href="functional-programming-making-and-using-your-own-functions.html#functions-returned">section to follow</a>, a function
can only return one <em>thing</em> (a number, or a vector, or dataset, or list, and so on).</p>
</div>
<div id="functions-conditionals" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Using conditional statements and categorical arguments<a class="anchor" aria-label="anchor" href="#functions-conditionals"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes you will want your function to behave differently under different
circumstances. For example, you might want to do one thing if your input is a
<b style="font-size:bigger">REALLY BIG</b> number, and another if it’s <span style="font-size:smaller">very small</span>.</p>
<p>Conditional <code>if</code> statements – which evaluate an expression and proceed <em>if</em> <code>TRUE</code> – can be useful for these occasions.
The function below takes one argument – <code>x</code> – and transforms it depending on how large it is:</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_smaller</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">return_number</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">10</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">return_number</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">5</span>
  <span class="op">}</span>
  <span class="va">return_number</span>
<span class="op">}</span></code></pre></div>
<p>If the input number is greater than 10, the <code>make_smaller</code> function will take
<code>10</code> off it; if it’s 10 or less, it will just take <code>5</code> off:</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_smaller</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_smaller</span><span class="op">(</span><span class="fl">13</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Making use of the <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> function could make this clearer.
If <code>x</code> is greater than <code>10</code>, the <code>make_smaller</code> function will now subtract <code>10</code>
and immediately return the value, ignoring everything else below it:</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_smaller</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="fu">make_smaller</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_smaller</span><span class="op">(</span><span class="fl">13</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>These conditional statements can be used for input options to your functions.
Let’s say you had a vector of ages of people in your office, <code>office_ages</code>:</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">office_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">21</span>, <span class="fl">36</span>, <span class="fl">56</span>, <span class="fl">67</span>, <span class="fl">200</span><span class="op">)</span>
<span class="va">office_ages</span></code></pre></div>
<pre><code>## [1]  -6  12  21  36  56  67 200</code></pre>
<p>To summarise your office by age, you might want a function that would round each age to the nearest <code>10</code>. You could make a function that rounds a number to the nearest <code>10</code>,
using the <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> function with <code>digits</code> set to <code>-1</code> (i.e. round to the nearest <code>10</code>):</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_age10</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">age</span>, digits <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -10  10  20  40  60  70 200</code></pre>
<p>Perfect. But some of those ages look implausible, and you might also want your function to validate them, by, say, capping ages to be between zero and <code>100</code>. You could let <code>validate_ages</code> be an argument, defaulting to <code>TRUE</code>, and <em>if it is <code>TRUE</code></em>, then you could perform the validation:</p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_age10</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>,
                       <span class="va">validate_ages</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># First, validate ages IF ASKED FOR</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">validate_ages</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">100</span>, <span class="va">age</span><span class="op">)</span>
    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">age</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="co"># Then round ages to the nearest 10:</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">age</span>, digits <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now, if <code>validate_ages == TRUE</code> (the default), the numbers over <code>100</code> will be replaced with <code>100</code>, and those less than <code>0</code> with <code>0</code>:</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]   0  10  20  40  60  70 100</code></pre>
<p>And you can turn that behaviour off by setting <code>validate_ages</code> to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span>, validate_ages <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -10  10  20  40  60  70 200</code></pre>
<p>However, we might not trust an age entry of <code>-6</code> or <code>200</code> at all, and might want to give the user the option to remove them rather than assume they are <code>0</code> or <code>100</code>. We could provide that option in one of two ways.</p>
<p>The first is to add another argument, shown below.</p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_age10</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>,
                       <span class="va">validate_ages</span> <span class="op">=</span> <span class="cn">TRUE</span>,
                       <span class="va">remove_implausible</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># First, validate ages</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">validate_ages</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">remove_implausible</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># Replace implausible ages with NAs</span>
      <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">100</span> <span class="op">|</span> <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">age</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">remove_implausible</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># Replace implausible ages with their nearest plausible age</span>
      <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">100</span>, <span class="va">age</span><span class="op">)</span>
      <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">age</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="co"># Then round ages to the nearest 10:</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">age</span>, digits <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This is fine! By default, the function still works like it did previously:</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span>, validate_ages <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]   0  10  20  40  60  70 100</code></pre>
<p>And if the user wants to validate ages <strong>and</strong> they want to remove the
implausible ages, then they will be replaced with <code>NA</code>:<a href="contributing-to-this-book.html#fn49" class="footnote-ref" id="fnref49"><sup>49</sup></a></p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span>, validate_ages <span class="op">=</span> <span class="cn">TRUE</span>, remove_implausible <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA 10 20 40 60 70 NA</code></pre>
<p>But those nested conditional statements – which are often
needed! – can be a bit of a headache.
There is another way we can do this, which might be neater in this instance.
The <code>validate_ages</code> argument could take a character string that tells it which
validation method to use. We could use <code>"remove"</code> and <code>"adjust"</code> to indicate the
validation methods:</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_age10</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>,
                       <span class="va">validate_ages</span> <span class="op">=</span> <span class="st">"remove"</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># First, validate ages</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">validate_ages</span> <span class="op">==</span> <span class="st">"remove"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">100</span> <span class="op">|</span> <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">age</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">validate_ages</span> <span class="op">==</span> <span class="st">"adjust"</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Replace implausible ages with their nearest plausible age</span>
    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">100</span>, <span class="va">age</span><span class="op">)</span>
    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">age</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="co"># Then round ages to the nearest 10:</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">age</span>, digits <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now we can use the <code>validate_ages</code> argument by itself to get the results we want:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span>, validate_ages <span class="op">=</span> <span class="st">"adjust"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]   0  10  20  40  60  70 100</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span>, validate_ages <span class="op">=</span> <span class="st">"remove"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA 10 20 40 60 70 NA</code></pre>
</div>
<div id="functions-returned" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> What is ‘returned’ from a function?<a class="anchor" aria-label="anchor" href="#functions-returned"><i class="fas fa-link"></i></a>
</h2>
<p>A function can do lots of things in the background.
For example, you might want to take a vector, square every number,
and then add all those numbers up:</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># first, add one to each using the function we defined above</span>
  <span class="va">added</span> <span class="op">&lt;-</span> <span class="fu">add_one</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="co"># then sum all the numbers in the vector</span>
  <span class="va">summed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">added</span><span class="op">)</span>
  <span class="co"># then return the summed object</span>
  <span class="va">summed</span>
<span class="op">}</span></code></pre></div>
<p>Running that function on a vector of numbers <span class="math inline">\(1, 2, 3, ..., 10\)</span> (created with <code>1:10</code>) does what we want:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sum_squares</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 65</code></pre>
<p>But look in your <strong>Environment</strong> window. The two objects that were created in the
function – <code>added</code> and <code>summed</code> – aren’t there! They are instead calculated,
stored in the background, and removed when the function is finished.</p>
<p>A function only returns <strong>one thing</strong>; everything else that is created in it
is discarded.<a href="contributing-to-this-book.html#fn50" class="footnote-ref" id="fnref50"><sup>50</sup></a>
This behaviour keeps your environment clean and tidy, but it can cause some frustration when you’re getting started.</p>
<p>That <strong>one thing</strong> that is returned is – by default – the last thing printed in
the function. <em>this is a bad explanation that I need to make better</em>
For <code>sum_squares</code> above, we defined two objects and then passed the <code>summed</code> to
the end of the function. If we omitted the last step, the function wouldn’t return <em>anything</em>:</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">empty_sum_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># first, add one to each using the function we defined above</span>
  <span class="va">added</span> <span class="op">&lt;-</span> <span class="fu">add_one</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="co"># then sum all the numbers in the vector</span>
  <span class="va">summed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">added</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">empty_sum_squares</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>The <code>empty_sum_squares</code> function took the <code>1:10</code> vector, then added one, then
summed the resulting numbers. But it didn’t <em>return</em> anything.
It just assigned values to the <code>added</code> and <code>summed</code> objects, then the function
finished and those objects vanished.</p>
<p>The <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> function can help you make this behaviour clear. Using <code><a href="https://rdrr.io/r/base/function.html">return()</a></code>
will stop your function in its tracks and pass the object out of the function.
We can use it in the <code>sum_squares</code> function:</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># first, add one to each using the function we defined above</span>
  <span class="va">added</span> <span class="op">&lt;-</span> <span class="fu">add_one</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="co"># then sum all the numbers in the vector</span>
  <span class="va">summed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">added</span><span class="op">)</span>
  <span class="co"># then return the summed object</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">summed</span><span class="op">)</span> <span class="co"># function stops here!</span>
<span class="op">}</span></code></pre></div>
<p>Ensuring your function <em>returns</em> the object you want in the form you want is the second step in writing your own functions.</p>
</div>
<div id="using-functions-on-datasets-within-mutate" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> Using functions on datasets within <code>mutate()</code><a class="anchor" aria-label="anchor" href="#using-functions-on-datasets-within-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>Recall that when you are adding (or changing) a variable in a dataset with <code>mutate</code>, the length of the output must be either the length of the dataset or one (which is then repeated). Anything else will throw an error:</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">office_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">office_ages</span><span class="op">)</span>
<span class="va">office_df</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##   office_ages
##         &lt;dbl&gt;
## 1          -6
## 2          12
## 3          21
## 4          36
## 5          56
## 6          67
## 7         200</code></pre>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A single element will be repeated:</span>
<span class="va">office_df</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fave_colour <span class="op">=</span> <span class="st">"#F68B33"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   office_ages fave_colour
##         &lt;dbl&gt; &lt;chr&gt;      
## 1          -6 #F68B33    
## 2          12 #F68B33    
## 3          21 #F68B33    
## 4          36 #F68B33    
## 5          56 #F68B33    
## 6          67 #F68B33    
## 7         200 #F68B33</code></pre>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A vector of length of the dataset is fine:</span>
<span class="va">office_df</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fave_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">99</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   office_ages fave_number
##         &lt;dbl&gt;       &lt;dbl&gt;
## 1          -6          10
## 2          12           4
## 3          21           1
## 4          36           4
## 5          56           0
## 6          67          99
## 7         200         100</code></pre>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># BUT a vector of a different length will cause an error:</span>
<span class="va">office_df</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fave_lunch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pasta salad"</span>, <span class="st">"a variety"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: Problem with `mutate()` column `fave_lunch`.
## ℹ `fave_lunch = c("pasta salad", "a variety")`.
## ℹ `fave_lunch` must be size 7 or 1, not 2.</code></pre>
<p>In <a href="functional-programming-making-and-using-your-own-functions.html#functions-conditionals">the section above</a>, we created the <code>make_age10</code> function and applied it to our little vector of ages. The function took a vector and returned a vector of the same length:</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">office_ages</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">make_age10</span><span class="op">(</span><span class="va">office_ages</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
</div>
<div id="using-the-purrr-family-of-functions" class="section level2" number="13.6">
<h2>
<span class="header-section-number">13.6</span> Using the <code>purrr</code> family of functions<a class="anchor" aria-label="anchor" href="#using-the-purrr-family-of-functions"><i class="fas fa-link"></i></a>
</h2>
<p><em>Section to be finished</em>; see <a href="https://github.com/grattan/R_at_Grattan/issues/59" class="uri">https://github.com/grattan/R_at_Grattan/issues/59</a></p>
</div>
<div id="using-functions-for-visualisations" class="section level2" number="13.7">
<h2>
<span class="header-section-number">13.7</span> Using functions for visualisations<a class="anchor" aria-label="anchor" href="#using-functions-for-visualisations"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="sharing-your-useful-functions-with-grattan-and-the-world" class="section level2" number="13.8">
<h2>
<span class="header-section-number">13.8</span> Sharing your useful functions with Grattan and the world<a class="anchor" aria-label="anchor" href="#sharing-your-useful-functions-with-grattan-and-the-world"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="analysis.html"><span class="header-section-number">12</span> Analysis</a></div>
<div class="next"><a href="version-control.html"><span class="header-section-number">14</span> Version control</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#functional-programming-making-and-using-your-own-functions"><span class="header-section-number">13</span> Functional programming: making and using your own functions</a></li>
<li><a class="nav-link" href="#set-up-2"><span class="header-section-number">13.1</span> Set up</a></li>
<li><a class="nav-link" href="#defining-simple-functions"><span class="header-section-number">13.2</span> Defining simple functions</a></li>
<li><a class="nav-link" href="#functions-conditionals"><span class="header-section-number">13.3</span> Using conditional statements and categorical arguments</a></li>
<li><a class="nav-link" href="#functions-returned"><span class="header-section-number">13.4</span> What is ‘returned’ from a function?</a></li>
<li><a class="nav-link" href="#using-functions-on-datasets-within-mutate"><span class="header-section-number">13.5</span> Using functions on datasets within mutate()</a></li>
<li><a class="nav-link" href="#using-the-purrr-family-of-functions"><span class="header-section-number">13.6</span> Using the purrr family of functions</a></li>
<li><a class="nav-link" href="#using-functions-for-visualisations"><span class="header-section-number">13.7</span> Using functions for visualisations</a></li>
<li><a class="nav-link" href="#sharing-your-useful-functions-with-grattan-and-the-world"><span class="header-section-number">13.8</span> Sharing your useful functions with Grattan and the world</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Using R at Grattan Institute</strong>" was written by Matt Cowgill, Will Mackey, and James Ha. It was last built on 2021-11-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
